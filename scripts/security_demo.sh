#!/bin/bash

echo "üîç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑–Ω–∏—Ü—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"
echo "=================================================================="

echo ""
echo "‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û: .env —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞"
echo "------------------------------------------------"

# –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–º–µ—Ä –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ .env
cat > /tmp/unsafe_env << EOF
BOT_TOKEN=1234567890:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
POSTGRES_PASSWORD=super_secret_password
EOF

chmod 644 /tmp/unsafe_env  # –û–±—ã—á–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

echo "–§–∞–π–ª: /tmp/unsafe_env"
echo "–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:"
ls -la /tmp/unsafe_env

echo ""
echo "–ö—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª:"
echo "- –í–ª–∞–¥–µ–ª–µ—Ü: ‚úÖ –î–∞"
echo "- –ì—Ä—É–ø–ø–∞: ‚úÖ –î–∞" 
echo "- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ: ‚úÖ –î–∞"
echo "- –í–µ–±-—Å–µ—Ä–≤–µ—Ä: ‚úÖ –î–∞"
echo "- –î—Ä—É–≥–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã: ‚úÖ –î–∞"

echo ""
echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∏–¥–Ω–æ –≤—Å–µ–º:"
cat /tmp/unsafe_env

echo ""
echo "=================================================================="
echo ""
echo "‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏"
echo "------------------------------------------------"

# –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
sudo mkdir -p /tmp/secure_config
sudo chmod 700 /tmp/secure_config

sudo tee /tmp/secure_config/env > /dev/null << EOF
BOT_TOKEN=1234567890:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
POSTGRES_PASSWORD=super_secret_password
EOF

sudo chmod 600 /tmp/secure_config/env
sudo chown root:root /tmp/secure_config/env

echo "–§–∞–π–ª: /tmp/secure_config/env"
echo "–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:"
sudo ls -la /tmp/secure_config/env

echo ""
echo "–ö—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª:"
echo "- root: ‚úÖ –î–∞"
echo "- –ì—Ä—É–ø–ø–∞: ‚ùå –ù–µ—Ç"
echo "- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ: ‚ùå –ù–µ—Ç"
echo "- –í–µ–±-—Å–µ—Ä–≤–µ—Ä: ‚ùå –ù–µ—Ç"
echo "- –î—Ä—É–≥–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã: ‚ùå –ù–µ—Ç"

echo ""
echo "–ü–æ–ø—ã—Ç–∫–∞ —á—Ç–µ–Ω–∏—è –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:"
if cat /tmp/secure_config/env 2>/dev/null; then
    echo "‚ùå –§–∞–π–ª –ø—Ä–æ—á–∏—Ç–∞–Ω!"
else
    echo "‚úÖ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω (Permission denied)"
fi

echo ""
echo "=================================================================="
echo ""
echo "üéØ –í–´–í–û–î–´:"
echo "----------"
echo "1. .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ = –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º"
echo "2. –§–∞–π–ª –≤ /etc/ —Å –ø—Ä–∞–≤–∞–º–∏ 600 = –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ root"
echo "3. Docker –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª —á–µ—Ä–µ–∑ volume mount"
echo "4. –°–µ–∫—Ä–µ—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞"
echo "5. –ù–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
echo "6. –ù–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –±—ç–∫–∞–ø—ã –∫–æ–¥–∞"

# –û—á–∏—Å—Ç–∫–∞
rm -f /tmp/unsafe_env
sudo rm -rf /tmp/secure_config

echo ""
echo "üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤!"
